$ModLoad imudp          # Module to support UDP remote messages inbound
$UDPServerAddress *     # Listen to any/all inbound IP addresses (note that the * is default, specifying to make config clear)
$UDPServerRun 514       # Listen on port 514

$ModLoad immark.so     # provides --MARK-- message capability (every 1 hour)
$MarkMessagePeriod     3600

$ModLoad imuxsock.so   # provides support for local system logging (e.g. via logger command)
                       # reduce dupplicate log messages (last message repeated n times)
$RepeatedMsgReduction on

$ModLoad imklog.so     # kernel logging (may be also provided by /sbin/klogd),
                       # see also http://www.rsyslog.com/doc-imklog.html.
$klogConsoleLogLevel 1 # set log level 1 (same as in /etc/sysconfig/syslog).

# Define template for vipr logs (messages, auth): 
$template vipr_log_format,"%TIMESTAMP:1:4:date-mysql%-%TIMESTAMP:5:6:date-mysql%-%TIMESTAMP:7:8:date-mysql% %TIMESTAMP:8:15:% [%syslogfacility-text%] %syslogseverity-text% %syslogtag%%msg:::sp-if-no-1st-sp%%msg:::drop-last-lf%\n"

# Define template for vipr alert logs (systemevents):
$template vipr_alerts_log_format,"%TIMESTAMP:1:4:date-mysql%-%TIMESTAMP:5:6:date-mysql%-%TIMESTAMP:7:8:date-mysql% %TIMESTAMP:8:15:% [%syslogfacility-text%] %syslogseverity-text% ALERTS: %syslogtag%%msg:::sp-if-no-1st-sp%%msg:::drop-last-lf%\n"

# Use traditional log format by default. 
$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat

# Include config generated by /etc/init.d/syslog script
# using the SYSLOGD_ADDITIONAL_SOCKET* variables in the
# /etc/sysconfig/syslog file.
$IncludeConfig /var/run/rsyslog/additional-log-sockets.conf

# Include config files, that the admin provided? :
$IncludeConfig /etc/rsyslog.d/*.conf

# print most important on tty10 and on the xconsole pipe
if ( \
        /* kernel up to warning except of firewall  */ \
        ($syslogfacility-text == 'kern')      and      \
        ($syslogseverity <= 4 /* warning */ ) and not  \
        ($msg contains 'IN=' and $msg contains 'OUT=') \
    ) or ( \
        /* up to errors except of facility authpriv */ \
        ($syslogseverity <= 3 /* errors  */ ) and not  \
        ($syslogfacility-text == 'authpriv')           \
    ) \
then  /dev/tty10
& |/dev/xconsole

# Emergency messages to everyone logged on (wall)
*.emerg  :omusrmsg:*

# Added for "local7" logging (All warn and more urgent go to file)
local7.warn /var/log/messages;vipr_log_format

# cron messages to dedicated cron log (STIG GEN003160)
$FileCreateMode 0600
cron.* -/var/log/cron

# firewall messages into separate file and stop their further processing
if             ($syslogfacility-text == 'kern') and \
                ($msg contains 'IN=' and $msg contains 'OUT=') \
then      -/var/log/firewall
& ~

# acpid messages into separate file and stop their further processing
if             ($programname == 'acpid' or $syslogtag == '[acpid]:') and \
                ($syslogseverity <= 5 /* notice */) \
then      -/var/log/acpid
& ~

# NetworkManager into separate file and stop their further processing
if      ($programname == 'NetworkManager') or \
                ($programname startswith 'nm-') \
then      -/var/log/NetworkManager
& ~

# email-messages (log and stop further processing)
mail.*  -/var/log/mail
& ~

# news-messages (log and stop further processing)
news.* ~

# Warnings in one file (except iptables logged above)
*.=warning;*.=err  -/var/log/warn
*.crit              /var/log/warn

# All messages except iptables and the facilities news and mail logged above
$FileOwner root
$FileGroup root
$FileCreateMode 0640
*.*;mail.none   -/var/log/messages;vipr_log_format
$FileOwner root
$FileGroup root
$FileCreateMode 0644

# Some foreign boot scripts require local7
local0,local1.*  -/var/log/localmessages
local2,local3.*  -/var/log/localmessages
local4,local5.*  -/var/log/localmessages
local6,local7.*  -/var/log/localmessages

# Log file for Bourne node AUTH facility - all messages from auth facility
$FileOwner root
$FileGroup storageos
$FileCreateMode 0640
auth.* /var/log/auth;vipr_log_format

#Alerts use local7 - will capture warn or more severe
local7.warn /var/log/systemevents;vipr_alerts_log_format

# webstorage; anything that contains the string "[ws_native]" written to the /opt/storageos/logs/blobsvc_native.log, then messages are discarded
$FileOwner root
$FileGroup root
$FileCreateMode 0644
:msg, contains, "[ws_native]" /opt/storageos/logs/blobsvc_native.log
& ~

# storageserver destination: Anything that contains "storageserver" is logged and then discarded
$FileOwner storageos
$FileGroup storageos
$FileCreateMode 0664
:msg, contains, "storageserver" /var/log/storageserver.log
& ~

## END of file

