<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

	<!-- List of supported Namespaces -->
	<bean id="namespaces"
		class="com.emc.storageos.plugins.common.domainmodel.NamespaceList">
		<property name="nsList">
			<map>
				<entry key="discover" value-ref="discoverer" />
			</map>
		</property>
	</bean>

	<!-- List of operations for this performance namespace -->
	<bean id="discoverer" class="com.emc.storageos.plugins.common.domainmodel.Namespace">
		<property name="_operations">
			<list>
				<ref bean="computerSystem" />

				<!-- get StoragePools -->
				<ref bean="getStoragePools" />

				<!-- get Storage Volume info with provider 8.x -->
				<!-- getAllocatedFromStoragePoolsFor8x is needed by getStorageVolumesFor8x -->
				<ref bean="getAllocatedFromStoragePoolsFor8x" />
				<ref bean="getStorageVolumesFor8x" />

				<!-- get Storage Volume info with provider 4.x -->
				<ref bean="getStorageVolumesFor4x" />

				<!-- get element composition service -->
				<ref bean="getElementCompositionService" />

				<!-- get meta volume paths -->
				<ref bean="getMetaVolumesPath" />

				<!-- SMI-S call to get cim object paths for composite elements for a given composite volume. -->
				<ref bean="getCompositeElements" />

				<!-- SMI-S call to get cim object paths for EMC_Meta for a given composite volume. -->
				<ref bean="getEMCMetaPath" />
			</list>
		</property>
	</bean>

	<!-- SMI Call to get CIMObject Path for the System -->
	<bean id="computerSystem" class="com.emc.storageos.plugins.common.domainmodel.Operation">
		<property name="_arguments">
			<list>
				<ref bean="reference-comp" />
			</list>
		</property>
		<property name="instance" ref="cimClient" />
		<property name="_result" value="ComputerSystem" />
		<property name="_method" value="enumerateInstanceNames" />
		<property name="_processor" ref="cimpathprocessor" />
		<property name="message" value="Invoking EnumerateInstances of EMC_StorageSystem to find the right Array" />
	</bean>

	<bean id="reference-comp" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getReferenceValue" />
		<property name="_value" value="ComputerSystem" />
	</bean>

	<!-- Processors -->
	<bean id="cimpathprocessor"
		class="com.emc.storageos.plugins.common.processor.CIMPathProcessor" />

	<!-- SMI Call to get associated StoragePools for an Array -->
	<bean id="getStoragePools" class="com.emc.storageos.plugins.common.domainmodel.Operation">
		<property name="_arguments">
			<list>
				<ref bean="reference-comp" />
				<ref bean="null" />
				<ref bean="resultClass-storagePool" />
				<ref bean="null" />
				<ref bean="null" />
				<ref bean="bool-true" />
				<ref bean="pool-prop" />
			</list>
		</property>
		<property name="instance" ref="cimClient" />
		<property name="_result" value="storagePools" />
		<property name="_method" value="associatorInstances" />
		<property name="_processor" ref="storagePoolProcessor" />
		<property name="message" value="Invoking associatorInstances to get StoragePools" />
	</bean>

	<bean id="resultClass-storagePool" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getStringValue" />
		<property name="_value" value="CIM_StoragePool" />
	</bean>

	<bean id="pool-prop" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getStringArrayValue" />
		<property name="_value"
			value="OperationalStatus,ElementName,EMCPoolID,PoolID,InstanceID,EMCSubscribedCapacity,TotalManagedSpace,RemainingManagedSpace,EMCIsBound,EMCTotalRawCapacity,EMCRemainingRawCapacity,EMCDiskDriveType,EMCMaxSubscriptionPercent" />
		<property name="_name" value="prvcList" />
	</bean>

	<!-- Processors -->
	<bean id="storagePoolProcessor"
		class="com.emc.storageos.volumecontroller.impl.plugins.discovery.smis.processor.StoragePoolProcessor" />

	<!-- SMI Call to get volume SpaceConsumed using 8.x -->
	<bean id="getAllocatedFromStoragePoolsFor8x" class="com.emc.storageos.plugins.common.domainmodel.Operation">
		<property name="_arguments">
			<list>
				<ref bean="reference-vmax2pools" />
				<ref bean="resultClass-EMC_AllocatedFromStoragePools" />
				<ref bean="null" />
				<ref bean="bool-true" />
				<ref bean="allocatedFromStoragePool-prop" />
				<ref bean="null" />
				<ref bean="null" />
				<ref bean="timeout" />
				<ref bean="bool" />
				<ref bean="maxObjects" />
			</list>
		</property>
		<property name="instance" ref="cimClient" />
		<property name="_result" value="" />
		<property name="_method" value="references" />
		<property name="_processor" ref="allocatedFromStoragePoolProcessor" />
		<property name="supportedVersion" value="8.x" />
		<property name="message" value="Invoking references to get AllocatedFromStoragePool from Storage Pools using provider 8.x" />
	</bean>

	<bean id="reference-vmax2pools" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getReferenceValue" />
		<property name="_value" value="vmax2pools" />
	</bean>

	<bean id="resultClass-EMC_AllocatedFromStoragePools" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getStringValue" />
		<property name="_value" value="EMC_AllocatedFromStoragePool" />
	</bean>

	<bean id="allocatedFromStoragePool-prop" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getStringArrayValue" />
		<property name="_value" value="SpaceConsumed" />
		<property name="_name" value="prvcList" />
	</bean>

	<!-- Processors -->
	<bean id="allocatedFromStoragePoolProcessor"
		class="com.emc.storageos.volumecontroller.impl.plugins.discovery.smis.processor.AllocatedFromStoragePoolProcessor">
	</bean>

	<!-- SMI Call to get volume information using 8.x -->
	<bean id="getStorageVolumesFor8x" class="com.emc.storageos.plugins.common.domainmodel.Operation">
		<property name="_arguments">
			<list>
				<ref bean="reference-pools" />
				<ref bean="assocClass-EMC_AllocatedFromStoragePool" />
				<ref bean="resultClass-Volumes" />
				<ref bean="null" />
				<ref bean="null" />
				<ref bean="bool-true" />
				<ref bean="volume-prop" />
				<ref bean="null" />
				<ref bean="null" />
				<ref bean="timeout" />
				<ref bean="bool" />
				<ref bean="maxObjects" />
			</list>
		</property>
		<property name="instance" ref="cimClient" />
		<property name="_result" value="" />
		<property name="_method" value="associators" />
		<property name="_processor" ref="storageVolumeProcessor" />
		<property name="supportedVersion" value="8.x" />
		<property name="message" value="Invoking associators to get StorageVolumes from Storage Pools using provider 8.x" />
	</bean>

	<bean id="reference-pools" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getReferenceValue" />
		<property name="_value" value="storagePools" />
	</bean>

	<bean id="assocClass-EMC_AllocatedFromStoragePool" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getStringValue" />
		<property name="_value" value="EMC_AllocatedFromStoragePool" />
	</bean>

	<bean id="resultClass-Volumes" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getStringValue" />
		<property name="_value" value="CIM_StorageVolume" />
	</bean>

	<bean id="volume-prop" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getStringArrayValue" />
		<property name="_value"
			value="EMCIsComposite,EMCSpaceConsumed,Usage,BlockSize,ConsumableBlocks" />
		<property name="_name" value="prvcList" />
	</bean>

	<!-- Processors -->
	<bean id="storageVolumeProcessor"
		class="com.emc.storageos.volumecontroller.impl.plugins.discovery.smis.processor.StorageVolumeProcessor">
		<property name="partitionManager" ref="partitionManager" />
	</bean>

	<!-- SMI Call to get volume information using provider 4.x -->
	<bean id="getStorageVolumesFor4x" class="com.emc.storageos.plugins.common.domainmodel.Operation">
		<property name="_arguments">
			<list>
				<ref bean="reference-pools" />
				<ref bean="assocClass-EMC_AllocatedFromStoragePoolView" />
				<ref bean="resultClass-VolumeViews" />
				<ref bean="null" />
				<ref bean="null" />
				<ref bean="bool-true" />
				<ref bean="volumeview-prop" />
				<ref bean="null" />
				<ref bean="null" />
				<ref bean="timeout" />
				<ref bean="bool" />
				<ref bean="maxObjects" />
			</list>
		</property>
		<property name="instance" ref="cimClient" />
		<property name="_result" value="" />
		<property name="_method" value="associators" />
		<property name="_processor" ref="storageVolumeViewProcessor" />
		<property name="supportedVersion" value="4.x" />
		<property name="message" value="Invoking associators to get StorageVolumeView from Storage Pools using provider 4.x" />
	</bean>

	<bean id="assocClass-EMC_AllocatedFromStoragePoolView" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getStringValue" />
		<property name="_value" value="EMC_AllocatedFromStoragePoolView" />
	</bean>

	<bean id="maxObjects" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getIntValue32" />
		<property name="_value" value="10" />
		<property name="_name" value="maxObjects" />
	</bean>

	<bean id="timeout" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getIntValue32" />
		<property name="_value" value="1200" />
		<property name="_name" value="timeoutinSeconds" />
	</bean>

	<bean id="resultClass-VolumeViews" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getStringValue" />
		<property name="_value" value="CIM_VolumeView" />
	</bean>

	<bean id="volumeview-prop" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getStringArrayValue" />
		<property name="_value"
			value="EMCSVIsComposite,AFSPSpaceConsumed,SVUsage,SVBlockSize,SVConsumableBlocks" />
		<property name="_name" value="prvcList" />
	</bean>

	<!-- Processors -->
	<bean id="storageVolumeViewProcessor"
		class="com.emc.storageos.volumecontroller.impl.plugins.discovery.smis.processor.StorageVolumeViewProcessor">
		<property name="partitionManager" ref="partitionManager" />
	</bean>

	<!-- SMI-S call for associatorNames to get instance of element composition service for storage array -->
	<bean id="getElementCompositionService" class="com.emc.storageos.plugins.common.domainmodel.Operation">
		<property name="_arguments">
			<list>
				<ref bean="reference-comp" />   <!-- Array’s Object path in map , which already got populated from previous beans. -->
				<ref bean="null" />
				<ref bean="resultClass-ElementCompositionService" /> <!-- bean for result class argument -->
				<ref bean="null" />
				<ref bean="null" />
			</list>
		</property>
		<property name="instance" ref="cimClient" />
		<property name="_result" value="elementCompositionService" />
		<property name="_method" value="associatorNames" />
		<property name="_processor" ref="cimpathprocessor" />   <!-- by default stores the object path in the above result key in Map -->
		<property name="message" value="Invoking associatorNames to get ElementCompositionService of Array" />
	</bean>

	<bean id="resultClass-ElementCompositionService" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getStringValue" />
		<property name="_value" value="EMC_ElementCompositionService" />
	</bean>

	<!-- SMI-S call for associatorNames to get instances of storage volumes paths(EMC_StorageVolume) for storage volume views -->
	<bean id="getMetaVolumesPath" class="com.emc.storageos.plugins.common.domainmodel.Operation">
		<property name="_arguments">
			<list>
				<ref bean="reference-metaVolumesViewList" />
				<ref bean="null" />
				<ref bean="resultClass-Volume" /> <!-- bean for result class argument -->
				<ref bean="null" />
				<ref bean="null" />
			</list>
		</property>
		<property name="instance" ref="cimClient" />
		<property name="_result" value="metaVolumesList" />
		<property name="_method" value="associatorNames" />
		<property name="_processor" ref="cimpathprocessor" />   <!-- by default stores the object path in the above result key in Map -->
		<property name="supportedVersion" value="4.x" /> <!-- only necessary for 4.x. For 8.x, metaVolumesList is set in getStorageVolumesFor8x -->
		<property name="message" value="Invoking associatorNames to get StorageVolume path for meta volume." />
	</bean>

	<bean id="resultClass-Volume" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getStringValue" />
		<property name="_value" value="CIM_StorageVolume" />
	</bean>

	<bean id="reference-metaVolumesViewList" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getReferenceValue" />
		<property name="_value" value="metaVolumesViewList" />
	</bean>

	<!-- SMI-S call to get cim object paths for composite elements for a given composite volume. -->
	<bean id="getCompositeElements" class="com.emc.storageos.plugins.common.domainmodel.Operation">
		<property name="_arguments">
			<list>
				<ref bean="reference-ElementCompositionService" />
				<ref bean="intrinsicMethodName-GetCompositeElements" />
				<ref bean="cimArgArray-getCompositeElements" />
				<ref bean="cimoutputArray" />
			</list>
		</property>
		<property name="instance" ref="cimClient" />
		<property name="_result" value="" />
		<property name="_method" value="invokeMethod" />
		<property name="_processor" ref="metaVolumeMembersProcessor" />
		<!-- executionCycle: execute for each meta volume CIMObjectPath instance 
			stored as an entry ("metaVolumesList", List<CIMObjectPath>) in the Map earlier. -->
		<property name="executionCycles" value="metaVolumesList" />
		<property name="message" value="Invoking GetCompositeElements for meta volume." />
	</bean>

	<bean id="reference-ElementCompositionService" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getReferenceValue" />
		<property name="_value" value="elementCompositionService" /> <!-- key for cim path instance in the map -->
	</bean>

	<bean id="intrinsicMethodName-GetCompositeElements" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getStringValue" />
		<property name="_value" value="GetCompositeElements" />
	</bean>

	<bean id="cimArgArray-getCompositeElements" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_value">
			<list>
				<ref bean="requestType" />
				<ref bean="theElement" />
			</list>
		</property>
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getCIMArgArray" />
	</bean>

	<bean id="requestType" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getIntValue16_CIMWrapper" />
		<property name="_value" value="2" />
		<property name="_name" value="RequestType" />
	</bean>

	<bean id="theElement" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getReferenceValue_CIMWrapper" />
		<property name="_value" value="metaVolumesList" />
		<property name="_name" value="TheElement" />
	</bean>

	<!-- Processor -->
	<bean id="metaVolumeMembersProcessor"
		class="com.emc.storageos.volumecontroller.impl.plugins.discovery.smis.processor.detailedDiscovery.MetaVolumeMembersProcessor" />

	<!-- SMI-S call for associatorNames to get instances of paths for EMC_Meta -->
	<bean id="getEMCMetaPath" class="com.emc.storageos.plugins.common.domainmodel.Operation">
		<property name="_arguments">
			<list>
				<ref bean="reference-metaVolumesList" />
				<ref bean="null" />
				<ref bean="resultClass-EMCMeta" /> <!-- bean for result class argument -->
				<ref bean="null" />
				<ref bean="null" />
			</list>
		</property>
		<property name="instance" ref="cimClient" />
		<property name="_result" value="" />
		<property name="_method" value="associatorNames" />
		<property name="_processor" ref="metaVolumeTypeProcessor" />
		<property name="message" value="Invoking associatorNames to get EMC_Meta path for meta volume." />
	</bean>

	<bean id="reference-metaVolumesList" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getReferenceValue" />
		<property name="_value" value="metaVolumesList" />
	</bean>

	<bean id="resultClass-EMCMeta" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getStringValue" />
		<property name="_value" value="EMC_Meta" />
	</bean>

	<bean id="metaVolumeTypeProcessor"
		class="com.emc.storageos.volumecontroller.impl.plugins.discovery.smis.processor.detailedDiscovery.MetaVolumeTypeProcessor" />

	<bean id="cimoutputArray" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getCIMArrayValue" />
		<property name="_value" value="" />
	</bean>

	<bean id="null" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getStringValue" />
		<property name="_value">
			<null />
		</property>
	</bean>

	<bean id="bool" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getBoolValue" />
		<property name="_value" value="false" />
		<property name="_name" value="qualifiers" />
	</bean>

	<bean id="bool-true" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getBoolValue" />
		<property name="_value" value="true" />
		<property name="_name" value="qualifiers" />
	</bean>

	<!-- ArgsCreator Instance -->
	<bean id="argscreator"
		class="com.emc.storageos.volumecontroller.impl.plugins.discovery.smis.SmisDiscoveryArgsCreator">
		<constructor-arg ref="smiutility" />
	</bean>

	<!-- SMIUtility -->
	<bean id="smiutility" class="com.emc.storageos.plugins.common.Util" />

	<!-- cimClient -->
	<bean id="cimClient" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getReferenceValue" />
		<property name="_value" value="cimClient" />
	</bean>

	<bean id="cimInstance" class="com.emc.storageos.plugins.common.domainmodel.Argument">
		<property name="_creator" ref="argscreator" />
		<property name="_method" value="getReferenceValue" />
		<property name="_value" value="vnxpoolsettinginstances" />
	</bean>

	<bean id="partitionManager" class="com.emc.storageos.plugins.common.PartitionManager" />

	<!-- Common for vnxBlock & VMAX -->
	<bean id="block"
		class="com.emc.storageos.volumecontroller.impl.plugins.SMICommunicationInterface">
		<property name="_executor" ref="executor" />
		<property name="_namespaces" ref="namespaces" />
	</bean>

	<bean id="commandgenerator"
		class="com.emc.storageos.plugins.common.commandgenerator.CommandGenerator">
		<property name="util" ref="smiutility" />
	</bean>

	<bean id="executor"
		class="com.emc.storageos.volumecontroller.impl.plugins.metering.smis.SMIExecutor">
		<property name="_util" ref="smiutility" />
		<property name="_generator" ref="commandgenerator" />
	</bean>
</beans>
