#{extends 'main.html' /}

#{set navSelected: ['nav.storage', 'nav.events'] /}
#{set 'title'}&{'resources.event'}#{/set}


#{breadcrumb.container}
  #{breadcrumb.item @listAll()}&{'resources.events'}#{/breadcrumb.item}
  #{breadcrumb.item active:true}#{get 'title'/}#{/breadcrumb.item}
#{/breadcrumb.container}

<style>
.btn {
margin-bottom: 5px;
}
</style>
<script>
    var eventDetails = ${eventSummaryJson.raw()}
</script>

<div class="clear"/>
#{alerts disappear:true/}
<div id="eventDetails" class="events-container" style="margin-bottom: 2em;" ng-controller="eventDetailsCtrl">
  #{if event}
  
    <div class="form-header">
      <div class="description">
        <h2>#{icon 'events'/} &{'events.event'}: {{event.name}}</h2>
      </div>
      <div style="clear:both"></div>
    </div>  
    
    <div class="pull-right">
    #{if event.eventStatus.toString() == 'pending'}
          <a class="btn btn-success" href="@{approveEvent(event.id)}"><span class="glyphicon"></span> &{'resources.events.approveEvent'}</a><br/>
          <a class="btn btn-warning" href="@{declineEvent(event.id)}"><span class="glyphicon"></span> &{'resources.events.declineEvent'}</a><br/>
	#{/if}
    </div>
    
    <dl class="dl-horizontal smallColumn">
    
      <dt>&{'events.id'}:</dt>
      <dd>{{event.id}}&nbsp;</dd>

      <dt>&{'events.name'}:</dt>
      <dd>{{event.name}}&nbsp;</dd>

      <dt>&{'events.resource'}:</dt>
      <dd><v-resource-link id="{{event.resourceId}}">{{event.resourceName}}</v-resource-link>&nbsp;</dd>

      <dt>&{'events.eventStatus'}:</dt>
      <dd>{{event.eventStatus}}&nbsp;</dd>

      <dt>&{'events.description'}:</dt>
      <dd>{{event.description}}&nbsp;</dd>

      <dt>&{'events.created'}:</dt>
      <dd id="start">{{getLocalDateTime($('#start'),event.created)}}&nbsp;</dd>
    </dl>
    
   <div class="alert alert-danger" ng-show="event.isError">
    <span style="font-weight: bold;">Error {{event.serviceCode_error}}:  {{event.serviceCode_errorDesc}}</span>
    <br/>
    {{event.serviceCode_message}}<br/>
   </div>
    
  #{/if}
  #{else}
    <p id="alerts_info" class="alert alert-danger">
        &{'events.notfound',eventId}
    </p>
  #{/else}
</div>

#{set 'moreScripts'}
#{get 'moreScripts' /}
<script type="text/javascript">
function renderTime(o, val) {
  var time_ms = o.aData.timeMillis;
  if (time_ms) {
	  return render.localDate(o,time_ms)
  }
  return "";
}

function renderSeverity(o, val) {
  var severity = o.aData.severity;
  if (severity) {
    severity = severity.toUpperCase();
    subClass = ""
	if ("FATAL" == severity) {
      subClass = "label-danger"
	}
	else if ("EMERG" == severity) {
	  subClass = "label-danger"
	}
	else if ("ALERT" == severity) {
	  subClass = "label-danger"
	}
	else if ("CRIT" == severity) {
	  subClass = "label-danger"
	}
	else if ("ERROR" == severity) {
	  subClass = "label-danger"
	}
	else if ("WARN" == severity) {
	  subClass = "label-warning"
	}
	else if ("NOTICE" == severity) {
	  subClass = "label-warning"
	}				
	else if ("INFO" == severity) {
	  subClass = "label-info"
	}
	else if ("DEBUG" == severity) {
	  subClass = ""
	}
	else if ("TRACE" == severity) {
	  subClass = ""
	}				
	else {
	  subClass = "label-inverse"
	}   
	
	return "<div style='width:50px' class='text-center label " + subClass + "'>" + severity + "</div>"
  }
}

function renderMessage(o, val) {
  var message = o.aData.message;
  if (message) {
    return "<div class='log-message'>" + escapeHTML(message) + "</div>";
  }
  return ""; 
}

function renderDetails(data) {
  var details = "<dl class='dl-horizontal'><dt>&{'system.logs.nodeId'}</dt><dd>" + data.node_id + "</dd>";

  details += "<dt>&{'system.logs.nodeName'}</dt><dd>" + data.node_name + "</dd>";
  
  if (data["thread"]) {
	details += "<dt>&{'system.logs.thread'}</dt><dd>" + data.thread + "</dd>";
  }
  if (data["class"]) {
    details += "<dt>&{'system.logs.class'}</dt><dd>" + data["clazz"] + ":" + data.line + "</dd></dl>";
  }
  details += "<pre style='margin:15px;'>" + escapeHTML(data["message"]) + "</pre>";
  return details;
}
  
function escapeHTML(s) {
  if (s) {
    return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
  }
  return "";
}  

</script>

#{/set}
