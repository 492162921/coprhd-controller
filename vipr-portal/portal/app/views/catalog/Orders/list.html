#{extends 'main.html' /} #{set navSelected: ['nav.orders',
'nav.catalog', 'nav.viewOrders'] /}

<!-- <div class="col-sm-6 controls">
	<div class="row col-gap-sm">
		<div class="col-xs-5">
			<date-picker ng-model="myOrder.startDate" close="true"></date-picker>
			<input type="hidden" name="myOrder.startDate" id="startDateVal" 
				value="{{myOrder.startDate}}" />
		</div>
		<div class="col-xs-5">
			<date-picker ng-model="myOrder.endDate" close="true"></date-picker>
			<input type="hidden" name="myOrder.endDate" id="endDateVal" 
				value="{{myOrder.endDate}}" />
		</div>
		<div class="col-xs-2">
			<button type="button" id="submitBtn" class="btn btn-primary" onclick="updateDateRange()">
				<span v-icon="filter"></span> {{'system.logs.update' | t}}
			</button>
		</div>
	</div>
</div> -->
#{DataTable.header titleKey:'orders.title'/} 

<div class="max-days-selector" 
#{if maxDays == 0 }  style="width: 780px; margin-left: -650px;margin-right:170px" #{/if} 
#{else} style="margin-left: -170px;margin-right:170px" #{/else}
>
  <div class="description" >&{'orders.maxDays'}</div>
  <div class="control" style="width:110px;">
  #{field 'maxDays'}
    %{
      field.cssClass = 'input-sm'
      field.options = maxDaysOptions
      field.disableSearch = true
    }%
    #{Form.selectOne field:field/}
  #{/field}
  </div>
  
  <label class="description forRange">&{"orders.startDate"}:</label>
  <div class="control forRange" style="width:150px;">
      <date-picker ng-model="scheduler.startDate" close="true"></date-picker>
      <input type="hidden" name="scheduler.startDate" value="2016-10-31"/>
   </div>
  
   <label class="description forRange">&{"orders.endDate"}:</label>
   <div class="control forRange" style="width:150px;">
      <date-picker ng-model="scheduler.endDate" close="true"></date-picker>
      <input type="hidden" name="scheduler.endDate" value="{{scheduler.endDate}}"/>
   </div>
  
  <div class="clearfix"></div>
  
</div>

#{DataTable.table
id:'orders', dataTable:dataTable, source:@listJson(),
cssClass:'editableRows', options: ['fnServerParams': 'addParams']/}
<script type="text/javascript">
table.orders.dataTable.afterCreate(function(dataTable) {
    var itemsJson = #{jsAction @itemsJson(':ids')/};
    watchOrderStatus(dataTable.getDataTable(), itemsJson);
});

function addParams(aoData) {
    aoData.push({"name":"startDate", "value":"${startDate}"});
    aoData.push({"name":"endDate", "value":"${endDate}"});
}

function updateDateRange() {
	var startDate = $("#startDateVal").val();
	var endDate = $("#endDateVal").val();
	console.info(startDate+"\t"+endDate);
	var url = #{jsAction @list()/}()+"?startDate="+startDate+"&endDate="+endDate;
    window.location.href = url;
}

$(document).ready(function() {
    var requestMaxDays = "${maxDays}";
    if(requestMaxDays != 0) {
        $(".forRange").hide();
    }
    
    $('#maxDays').on('change', function() {
        var maxDays = $(this).val();
        if(maxDays == 0) {
            $(".forRange").show();
            $('.max-days-selector').css({'width': '780px', 'margin-left': '-650px', 'margin-right':'170px'});
        } else {
            var url = #{jsAction @allOrders()/}()+"?maxDays="+maxDays;
            window.location.href = url;
        }
    });
});
</script>