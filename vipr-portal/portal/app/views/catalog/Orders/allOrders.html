#{extends 'main.html'/}
#{set navSelected: ['nav.orders', 'nav.catalog', 'nav.allOrders'] /}

#{tenantSelector /}
#{DataTable.header titleKey:'allOrders.title' /}


<div class="max-days-selector" 
#{if maxDays == 0 }  style="width: 780px; margin-left: -650px;margin-right:170px" #{/if} 
#{else} style="margin-left: -170px;margin-right:170px" #{/else}
>
  <div class="description" >&{'orders.maxDays'}</div>
  <div class="control" style="width:110px;">
  #{field 'maxDays'}
    %{
      field.cssClass = 'input-sm'
      field.options = maxDaysOptions
      field.disableSearch = true
    }%
    #{Form.selectOne field:field/}
  #{/field}
  </div>
  
  <label class="description forRange">&{"orders.startDate"}:</label>
  <div class="control forRange" style="width:150px;">
      <date-picker ng-model="scheduler.startDate" close="true"></date-picker>
      <input type="hidden" name="scheduler.startDate" value="2016-10-31"/>
   </div>
  
   <label class="description forRange">&{"orders.endDate"}:</label>
   <div class="control forRange" style="width:150px;">
      <date-picker ng-model="scheduler.endDate" close="true"></date-picker>
      <input type="hidden" name="scheduler.endDate" value="{{scheduler.endDate}}"/>
   </div>
  
  <div class="clearfix"></div>
  
</div>
#{DataTable.table id:'orders', 
                  dataTable:dataTable, 
                  source: @allOrdersJson(),
                  selectable: true, 
                  options: ['fnServerParams': 'addParams']}
        #{DataTable.buttonBar}
            #{Form.button name:'button.download', class:'primary', icon:'download', submit:'createForm'/}
            #{Form.button name:'button.delete', class:'danger', icon:'trash', submit:'deleteForm'/}
        #{/DataTable.buttonBar}

#{/DataTable.table}

     #{Modal.dialog id:'deleteDialog', titleKey: 'Confirm to Delete Orders'}
      #{Modal.body cssClass:'form-horizontal'}
      All rows are checked, DELETE action will be performed on all <b style="color:red">9700</b> orders, please CONFIRM!           
          <div>
            <span class="help-block">We strongly recommend to download the orders before deleting them.</span>
          </div>
      #{/Modal.body}
      #{Modal.footer}
       #{Form.button 'button.confirm', icon:'ok-sign', data:['dismiss':'modal']/}
        #{Form.button 'button.close', icon:'trash', data:['dismiss':'modal']/}
      #{/Modal.footer}
    #{/Modal.dialog}
    
    #{Modal.dialog id:'downloadDialog', titleKey: 'Confirm to Download Orders'}
      #{Modal.body cssClass:'form-horizontal'}
      All rows are checked, DOWNLOAD will be performed on all 9700 orders, click 'Confirm' to start.           
          <div>
            <span class="help-block">Only one 'Download/Delete Orders' job is allowed at any time.</span>
          </div>
      #{/Modal.body}
      #{Modal.footer}
       #{Form.button 'button.confirm', icon:'ok-sign', data:['dismiss':'modal']/}
        #{Form.button 'button.close', icon:'trash', data:['dismiss':'modal']/}
      #{/Modal.footer}
    #{/Modal.dialog}

<script type="text/javascript">
function addParams(aoData) {
	var param = "${maxDays}";
	param = param == 0 ? 180: param;
    aoData.push({"name":"maxDays", "value": 90});//for mockup, 90 should be param
}
table.orders.dataTable.afterCreate(function(dataTable) {
    var itemsJson = #{jsAction @catalog.Orders.itemsJson(':ids')/};
    watchOrderStatus(dataTable.getDataTable(), itemsJson);
});
$(document).ready(function() {
	var requestMaxDays = "${maxDays}";
	if(requestMaxDays != 0) {
	    $(".forRange").hide();
	}
	//$( "input[type=checkbox]" ).prop('checked', true);//for mockup
	$( "input[type=text]" ).prop('readonly', false);//for mockup
	
    $('#maxDays').on('change', function() {
        var maxDays = $(this).val();
        if(maxDays == 0) {
        	$(".forRange").show();
        	$('.max-days-selector').css({'width': '780px', 'margin-left': '-650px', 'margin-right':'170px'});
        } else {
            var url = #{jsAction @allOrders()/}()+"?maxDays="+maxDays;
            window.location.href = url;
        }
    });
	
    $('.btn-danger').on('click', function() {
    	$('#deleteDialog').modal();
    });
    $('.btn-primary').on('click', function() {
        $('#downloadDialog').modal();
    });
	
});
</script>