#{set 'moreScripts'}
#{get 'moreScripts'/}
<script type="text/javascript">

    function reverse(s){
        return s.split("").reverse().join("");
    }

    $(document).ready(function () {
        var value = '${page.externalLocationUrl.value}';
        var servers = value.split(',');
        for (var i = 0; i < servers.length; i++) {

            var [server,port] = servers[i].split(']');
            if (port) {
                server = server.replace('[','');
                port = port.replace(':','');
            }
            else {
                var [server,port] = server.split(/:(.+)?/);
            }
            addServer(server,port);

            //ipv6 hack by reversing string to split by port colon
            //reverseElement = reverse(servers[i]);
            //var [port,server] = reverseElement.split(/:(.+)?/);
            //server = reverse(server);
            //port = reverse(port);
            //addServer(server,port);
        }
    });

    function addServer(server,port) {

      var ni = document.getElementById('server-group');
      var numi = document.getElementById('theValue');
      var num = (document.getElementById('theValue').value -1)+ 2;
      numi.value = num;
      var newdiv = document.createElement('tr');
      var divIdName = 'server_'+num;
      newdiv.setAttribute('id',divIdName);
      //newdiv.setAttribute('class','form-group');
      newdiv.innerHTML = '<td class="col-xs-8 ng-scope" v-field="config.value"> <input type="text" name="config.server" value="'+server+'" id="config_value" ng-model="field.value" class="form-control ng-scope ng-pristine ng-valid" autocomplete="off" ng-class="{errorMessage: config.error}" ng-change="config.dirty = true" ng-if="getSelectedConfigType().type !== \'Boolean\'" ng-readonly="config.systemDefault" ng-focus="config.focused = true" ng-blur="config.focused = false" style=""> <div class="text-info ng-hide" ng-show="config.focused &amp;&amp; (getSelectedConfigType().type === \'String\' || config.error)"> <small generate-preview="config" ng-class="{\'text-danger\': config.error}" class="text-danger">Required parameter value was missing or empty</small> </div> </td> <td class="col-xs-8 ng-scope" v-field="config.value"> <input type="text" name="config.port" value="'+port+'" id="config_value" ng-model="field.value" class="form-control ng-scope ng-pristine ng-valid" autocomplete="off" ng-class="{errorMessage: config.error}" ng-change="config.dirty = true" ng-if="getSelectedConfigType().type !== \'Boolean\'" ng-readonly="config.systemDefault" ng-focus="config.focused = true" ng-blur="config.focused = false" style=""> <div class="text-info ng-hide" ng-show="config.focused &amp;&amp; (getSelectedConfigType().type === \'String\' || config.error)"> <small generate-preview="config" ng-class="{\'text-danger\': config.error}" class="text-danger">Required parameter value was missing or empty</small> </div> </td> <td class="col-xs-1"> <button type="button" class="close" ng-hide="config.systemDefault" onClick="removeServer(\''+divIdName+'\')">Ã—</button> </td>';
      ni.appendChild(newdiv);

    }

    function removeServer(id) {

      var d = document.getElementById('server-group');

      var checkboxes = document.getElementById(id);

      d.removeChild(checkboxes);
    }
</script>
#{/set}

<input type="hidden" value="0" id="theValue" />
<br>
#{ConfigProperties.propertySet titleKey:'configProperties.syslog.servers'}

%{
property = page.externalLocationUrl
id = property.name
name = property.name
label = property.label
originalValue = property.value
value = flash[name] ?: originalValue
rebootRequired = property.rebootRequired
description = property.description
disabled:unstable;
}%

<div id="backup_scheduler_enableControlGroup" class="form-group ">
    <label class="control-label col-sm-3" for="${id}">${label}:</label>
    <div class="col-sm-6" z="">
        <div class="dataTables_wrapper">
            <table class="table table-hover table-condensed dataTable" style="table-layout: fixed;">
                <thead>
                <tr>
                    <th style="width: 160px;">Server</th>
                    <th style="width: 160px;">Port</th>
                    <th style="width: 25px;"></th>
                </tr>
                </thead>
                <tbody id="server-group" >

                </tbody>
            </table>

        </div>
        <div class="button-bar">
            <div>
                <button type="button" class="btn btn-success" name="button.add" onclick="addServer('','');">
                    <span class="glyphicon glyphicon-plus "></span> Add
                </button>
            </div>
        </div>
        <div class="col-sm-12">#{if description}<p class="help-block clear">${description}</p>#{/if}</div>
    </div>

    <div class="col-sm-3">
        <span class="help-inline clearfix">${error}</span>
    </div>
</div>

#{/ConfigProperties.propertySet}

#{ConfigProperties.propertySet titleKey:'configProperties.syslog.logs'}
<control-group v-field="filterDialog.service" width="6"  type="array" >
    <select-many id="services" class="max-height-5" options=[{"id":"sasvc","name":"sasvc"},{"id":"vasasvc","name":"vasasvc"},{"id":"portalsvc","name":"portalsvc"},{"id":"coordinatorsvc","name":"coordinatorsvc"},{"id":"geodbsvc","name":"geodbsvc"},{"id":"apisvc","name":"apisvc"},{"id":"geosvc","name":"geosvc"},{"id":"dbsvc","name":"dbsvc"},{"id":"syssvc","name":"syssvc"},{"id":"authsvc","name":"authsvc"},{"id":"controllersvc","name":"controllersvc"}]></select-many>
</control-group>
#{/ConfigProperties.propertySet}