#{extends 'main.html' /} 
#{set navSelected: ['nav.config', 'nav.disasterRecovery'] /} 

#{DataTable.header titleKey:'disasterRecovery.title'/}

#{DataTable.crudTable id:'disasterRecovery', 
					dataTable:dataTable,
					expandable: true,
					deleteConfirm:messages.get('disasterRecovery.deleteConfirm')}
#{/DataTable.crudTable}

<script id="inlineActions.html" type="text/ng-template">
    <div class="btn-group-site">
		#{deadbolt.restrict roles:[['SECURITY_ADMIN'], ['RESTRICTED_SECURITY_ADMIN']]}
			<a class="btn btn-default btn-xs" ng-show="isPauseSite" role="button" href="{{pauseUrl}}">{{'disasterRecovery.pauseButton' | t}}</a>
			<a class="btn btn-default btn-xs" ng-show="isResumeSite" role="button" href="{{resumeUrl}}">{{'disasterRecovery.resumeButton' | t}}</a>
			<a class="btn btn-default btn-xs" ng-show="isTestSite" role="button" href="{{testUrl}}">{{'disasterRecovery.testButton' | t}}</a>
			<a class="btn btn-default btn-xs" ng-show="isFailover" role="button" href="{{failoverUrl}}">{{'disasterRecovery.FailoverButton' | t}}</a>
		#{/deadbolt.restrict}
    </div>
</script>

<script type="text/javascript">
var standbypauseUrl = #{jsAction @pause(':uuid') /}
var standbyresumeUrl = #{jsAction @resume(':uuid') /}
var standbytestUrl = #{jsAction @test(':uuid') /}
var standbyfailoverUrl = #{jsAction @failover(':uuid') /}

angular.module('tags').directive({
	actions: function() {
     return {
         restrict: "E",
         templateUrl: "inlineActions.html",
         link: function(scope, elem, attrs) {
        	 scope.pauseUrl = standbypauseUrl({'uuid': scope.row.id});
        	 scope.resumeUrl = standbyresumeUrl({'uuid': scope.row.id});
        	 scope.testUrl = standbytestUrl({'uuid': scope.row.id});
			scope.failoverUrl = standbyfailoverUrl({'uuid': scope.row.id});
			scope.isPauseSite = false;
			scope.isResumeSite = false;
			scope.isTestSite = false;
			scope.isFailover = false;

        	 if(scope.row.status.toUpperCase() == "STANDBY_SYNCED"){
				scope.isPauseSite = true;
				scope.isTestSite = true;
				scope.isFailover = true;
             }
        	 
        	 if(scope.row.status.toUpperCase() == "STANDBY_PAUSED"){
				scope.isResumeSite = true;
             }
        	 
        	 if(scope.row.status.toUpperCase() == "PRIMARY"){
				scope.isResumeSite = false;
				scope.isPauseSite = false;
				scope.isTestSite = false;
				scope.isFailover = false;
             }
         }
     }
 },
 url: function() {
     return {
         restrict: "E",
         templateUrl: "inlineLink.html"
     }
 }
});

function renderButtonBar(o,val) {
    return "<actions></actions>";
    
}
</script>

<script type="text/javascript">
function watchLoadStatus(datatable, itemsJson) {
    var fields = ['status','VirtualIP','name'];
    var fieldToWatch = 'status';
    var triggerValues = ['STANDBY_ADDING','STANDBY_SYNCING','STANDBY_REMOVING'];
    watchDatatableField(datatable, itemsJson, fieldToWatch, triggerValues, fields);
}
$(document).ready(function() {
    var dataTable = table.disasterRecovery.dataTable.getDataTable()
    var itemsJson = #{jsAction @itemsJson(':ids')/};
    watchLoadStatus(dataTable, itemsJson);
});
</script>

<script type="text/javascript">

function standbyStatusIcon(o, val) {
    if (!o) {
        return "";
    }
    var labels = {
        'PRIMARY': 'label-success',
        'STANDBY_ADDING': 'label-info',
        'STANDBY_PAUSED': 'label-success',
        'STANDBY_SYNCED': 'label-success',
        'STANDBY_ERROR':  'label-danger',
        'STANDBY_REMOVING': 'label-info',
        'STANDBY_TESTING' : 'label-info',
        'STANDBY_SYNCING' : 'label-info'
    }
    var icons = {
        'PRIMARY':     'glyphicon glyphicon-ok',
        'STANDBY_ADDING': 'glyphicon glyphicon-refresh rotate',
        'STANDBY_PAUSED': 'glyphicon glyphicon-ok',
        'STANDBY_SYNCED': 'glyphicon glyphicon-ok',
        'STANDBY_ERROR':  'glyphicon glyphicon-remove',
        'STANDBY_REMOVING': 'glyphicon glyphicon-refresh rotate',
        'STANDBY_TESTING' : 'glyphicon glyphicon-refresh rotate',
        'STANDBY_SYNCING' : 'glyphicon glyphicon-refresh rotate'
    }

	var messages = {
		'PRIMARY': Messages.get("renderFunctions.disasterRecovery.status.primary"),
		'STANDBY_ADDING': Messages.get("renderFunctions.disasterRecovery.status.adding"),
		'STANDBY_SYNCING': Messages.get("renderFunctions.disasterRecovery.status.syncing"),
		'STANDBY_SYNCED': Messages.get("renderFunctions.disasterRecovery.status.synced"),
		'STANDBY_PAUSED': Messages.get("renderFunctions.disasterRecovery.status.paused"),
		'STANDBY_REMOVING': Messages.get("renderFunctions.disasterRecovery.status.removing"),
		'STANDBY_TESTING': Messages.get("renderFunctions.disasterRecovery.status.testing"),
		'STANDBY_ERROR': Messages.get("renderFunctions.disasterRecovery.status.error")
	};

    var label = defaultValue(labels[o.aData.status], 'label-default');
    var icon = defaultValue(icons[o.aData.status], 'glyphicon glyphicon-question-sign');

    var message = defaultValue(messages[o.aData.status], Messages.get("renderFunctions.disasterRecovery.status.unknown"));

    return '<span class="label ' + label + '"><span class="' + icon + '"></span></span>' + message+'</span>';
}
</script>

</script>
