#{set isActiveSite:controllers.infra.DisasterRecovery.isActiveSite() /}
#{set isExternalServerConfigured: util.BackupUtils.isExternalServerConfigured() /}

<div id="backupPanel">
    <div class="panel panel-default">
        <div class="panel-heading"><h3 class="panel-title">&{'adminDashboard.backupStatus'}</h3></div>
        <div class="panel-body">
        <table style="margin-top:0px;width:100%">
            <tbody>
            <tr class="odd ng-scope openRow">
                <td class="type" height="25px" width="170px">&{'adminDashboard.lastSuccessfulBackup'}: </td>
                <td class="icon" height="25px" width="25px">
                #{if backupStatus?.getLastSuccessfulBackup()?.opStatus}
                    <span class="text-success">#{icon 'ok-sign'/}</span>
                #{/if}
                </td>
                <td class="time">
                    <a href="@{Backup.list()}" id="lastSuccessful"></a>
                </td>
            </tr>
            <script>
                var lastSuccessfulCreationTime = '${backupStatus?.getLastSuccessfulBackup()?.opTime}';
                var lastSuccessfulBackupType = '${backupStatus?.getLastSuccessfulBackup()?.opMessage}';
                if (lastSuccessfulCreationTime) {
                    $('#lastSuccessful').append(formatLocalDateTime(new Date(lastSuccessfulCreationTime)));
	    	    } else {
	    	        $('#lastSuccessful').append("NA");
	    	    }
            </script>

            <tr class="odd ng-scope openRow">
                <td class="type" height="25px" width="170px">&{'adminDashboard.lastManualBackup'}: </td>
                <td class="icon" height="25px" width="25px">
                    #{if backupStatus?.getLastManualBackup()?.opStatus}
                        #{if 'success'.equalsIgnoreCase('${backupStatus?.getLastManualBackup()?.opStatus}')}
                            <span class="text-success">#{icon 'ok-sign'/}</span>
                        #{/if}
                        #{else}
                            <span class="text-danger">#{icon 'remove-sign'/}</span>
                        #{/else}
                    #{/if}
                </td>
                <td class="time">
                    <a href="@{Backup.list()}" id="lastManual"></a>
                </td>
            </tr>
            <script>
                var lastManualCreationTime = '${backupStatus?.getLastManualBackup()?.opTime}';
                if (lastManualCreationTime) {
                    $('#lastManual').append(formatLocalDateTime(new Date(lastManualCreationTime)));
	    	    } else {
	    	        $('#lastManual').append("NA");
	    	    }
            </script>

            <tr class="odd ng-scope openRow">
                <td class="type" height="25px" width="170px">&{'adminDashboard.lastScheduledBackup'}: </td>
                <td class="icon" height="25px" width="25px">
                    #{if backupStatus?.getLastScheduledBackup()?.opStatus}
                        #{if 'success'.equalsIgnoreCase('${backupStatus?.getLastScheduledBackup()?.opStatus}')}
                            <span class="text-success">#{icon 'ok-sign'/}</span>
                        #{/if}
                        #{else}
                            <span class="text-danger">#{icon 'remove-sign'/}</span>
                        #{/else}
                    #{/if}
                </td>
                <td class="time">
                    <a href="@{Backup.list()}" id="lastScheduled"></a>
                </td>
            </tr>
            <script>
                var lastScheduledCreationTime = '${backupStatus?.getLastScheduledBackup()?.opTime}';
                if (lastManualCreationTime) {
                    $('#lastScheduled').append(formatLocalDateTime(new Date(lastScheduledCreationTime)));
	    	    } else {
	    	        $('#lastScheduled').append("NA");
	    	    }
            </script>

            <tr class="odd ng-scope openRow">
                <td class="type" height="25px" width="170px">&{'adminDashboard.nextScheduledBackup'}: </td>
                <td class="icon" height="25px" width="25px"></td>
                <td id="nextScheduled" class="time"></td>
            </tr>
            <script>
                var nextScheduledCreationTime = '${backupStatus?.getNextScheduledBackup()?.opTime}';
                (nextScheduledCreationTime) ? $('#nextScheduled').append(formatLocalDateTime(new Date(nextScheduledCreationTime))) : $('#nextScheduled').append("NA");
            </script>

            <tr class="odd ng-scope openRow">
                <td class="type" height="25px" width="170px">&{'adminDashboard.lastUploadStatus'}: </td>
                <td class="icon" height="25px" width="25px">
                    #{if isExternalServerConfigured}
                        #{if backupStatus?.getLastUploadStatus()?.opStatus}
                            #{if 'true'.equalsIgnoreCase('${backupStatus?.getLastUploadStatus()?.opStatus}')}
                                <span class="text-success">#{icon 'ok-sign'/}</span>
                            #{/if}
                            #{else}
                                <span class="text-danger">#{icon 'remove-sign'/}</span>
                            #{/else}
                        #{/if}
                    #{/if}
                    #{else}
                        <span class="text-warning">#{icon 'warning-sign'/}</span>
                    #{/else}
                </td>
                <td class="time">
                    <a href="@{Backup.list()}" id="lastUpload"></a>
                </td>
            </tr>
            <script>
                if (isExternalServerConfigured) {
                    var lastUploadTime = '${backupStatus?.getLastUploadStatus()?.opTime}';
                    if (lastUploadTime) {
                        $('#lastUpload').append(formatLocalDateTime(new Date(lastUploadTime)));
	    	        } else {
	    	            $('#lastUpload').append("NA");
	    	        }
	    	    } else {
                    $('#lastUpload').append(&{'adminDashboard.lastUploadStatus.notConfigured'});
	    	    }
            </script>
            </tbody>
        </table>
        </div>
    </div>
    #{if backupStatusLastUpdated}
    <div class="panel-footer">
        <small>&{'adminDashboard.lastUpdated'}
            <span data-format-relative-time="${backupStatusLastUpdated.getTime()}"></span>
        </small>
    </div>
    #{/if}
</div>
